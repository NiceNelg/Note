# Linux下C语言的编译流程

---

1. 预编译

   > 预编译过程主要处理源代码文件中的`#`开始的预编译指令，可用以下命令查看预编译后的文件：
   >
   > `gcc -E hello.c -o hello.i`
   >
   > 预编译主要处理规则如下：

   - 将所有`#define`删除，并且展开所有的宏定义。

   - 处理所有条件预编译指令，比如`#if`、`#ifdef`、`#elif`、`#else`、`#endif`。

   - 处理`#include`预编译指令，将被包含的文件插入到该预编译指令的位置。注意：这个过程是递归执行的，因为被包含的文件可能还包含其他文件。

   - 删除所有注释。

   - 添加行号和文件名标识，比如`#2 "hello.c" 2`，以便于编译时编译器产生调试用的行号信息以及用于编译时产生编译错误或警告时能够显示行号。

   - 保留所有`#pragma`编译器指令，因为编译器需要它们。

     > 因为此时宏定义已经完全展开，因此当不确定宏定义是否正确时，可以在查看预编译后的文件来确定问题。

2. 编译

   > 编译的过程就是吧预编译处理完的文件进行一系列的词法分析、语法分析、语义分析及优化后生产对应的汇编代码文件，可用以下命令查看编译后的文件：
   >
   > `gcc -S hello.i -o hello.s`
   >
   > 或
   >
   > `gcc -S hello.c -o hello.s`

3. 汇编

   > 汇编的过程就是将编译生成后的汇编文件编译成机器指令的过程，可用以下指令生成可执行文件：
   >
   > `gcc -c hello.s -o hello.o`
   >
   > 或
   >
   > `as hello.s -o hello.o`
   >
   > 或
   >
   > `gcc -c hello.c -o hello.o`

4. 链接