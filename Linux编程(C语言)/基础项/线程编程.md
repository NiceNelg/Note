# 线程编程

1. 线程

   > 线程包含了表示进程内执行环境必须的信息，包括标识线程的线程ID，一组寄存器值，栈，调度优先级和策略，信号屏蔽字，errno变量以及线程私有数据,对于内存，堆内存和代码区一般属于一个进程的，但是栈却是属于一个线程的，每个线程都拥有一个独立的栈。

   - errno也是属于单个线程的，每个线程中的errno是独立的。
   - 进程内所有的信息对于线程都是共享的，包括执行代码，全局变量，和堆内存，栈以及文件描述符。线程标识
   - 就像每个进程有个进程ID一样，线程也有自己的ID。
   - 进程ID用pid_t来表示，他是一个unsigned int.
   - 线程可以通过pthread_t表示，pthread_t不能把它当整数处理。
   - 线程可以通过pthread_self()函数获得自身的线程ID

2. 线程创建

   - 在进程中只有一个控制线程

   - 程序开始运行的时候每个进程只有一个线程，它是以单线程方式启动的，在创建多个线程以前，进程的行为与传统的进程没有区别

   - gcc在链接的时候需要增加-lpthread选项（pthread是共享库文件）。

   - 创建一个线程调用pthread_create函数。

     ```c
     int pthread_create(pthread_t thread, const pthread_attr_t *attr, void *(start_routine) (void *), void *arg);
     ```

     - 如果pthread_create成功返回，有thread指向的内存单元被设置为新创建线程的线程ID。

     - attr参数用于定制各种不同的线程属性。

     - 新创建的线程从start_routine函数地址开始执行，该函数只有一个void *参数，

     - 如果需要向start_routine函数传递多个参数，就需要把这些参数放到一个结构中，然后把这个结构的地址作为void *传入。

     - 线程创建的时候不能保证哪个先运行。

     - pthread_create函数成功返回0，失败返回非0，并且更新errno。

       > 注意：每个线程都拥有一份errno副本，不同的线程拥有不同的errno

