# Makefile编写

---

1. 基本格式

   ```makefile
   目标:依赖1 依赖2 依赖3...
   	规则
   
   目标:依赖1 依赖2 依赖3...
   	规则
   ```

   > 规则前面严格使用`tab`缩进

2. 工作原理：

   `makefile`是以`目标`为单位执行指令的，若`总目标`中的`依赖`在目录中缺失会向下搜索其他`目标`，若发现其他`目标`是`总目标`的`依赖`则会先执行`目标`的指令生成依赖。

3. 自动变量

   - `$@`：规则中的目标
   - `$<`：规则中的第一个依赖
   - `$^`：规则中的所有依赖

   > 自动变量只能在规则中的命令中使用

4. 自定义变量

   1. 定义：`xxx=value`
   2. 使用：`$(xxx)`

5. 函数使用

   > `makefile`中所有的函数都有返回值

   1. 使用并赋值：`变量 = $(函数名 参数1 参数2...)`

6. 伪目标

   1. 定义：根据`makefile`的工作原理，若`目标`后面不跟`依赖`，且不在`任意目标`的`依赖`中，那么该`目标`则不会被执行，但可以使用`make 目标`命令执行指定`目标`的指令，这种`目标`可称为`伪目标`，主要做辅助作用

   2. 例子：

      ```makefile
      clean:
      	rm -f *.o
      ```

   3. 声明伪目标

      1. 说明：若一个目标明确是伪目标，那么该不需要依赖检测消耗资源，添加伪目标声明则可以排除依赖检测

      2. 例子：

         ```makefile
         .PHONY:clean
         clean:
         	rm -f *.o
         ```

         

7. 错误抑制符

   1. 说明：执行命令的时候可能会报错，若命令报错则会阻止后续的命令继续执行，这时候可以添加错误抑制符`-`进行错误抑制

   2. 例子：

      ```makefile
      clean:
      	-rm -f *.o
      	echo "Hello world"
      ```

      